

<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Automated Documentation/AST Support Tool &mdash; Spawn of EnergyPlus</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/united/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap_custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/lbl-icon.ico"/>
    <link rel="top" title="Spawn of EnergyPlus" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default ">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/soep-logo.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Index</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="preample.html">1. Preample</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preample.html#purpose-of-the-document">1.1. Purpose of the Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="preample.html#contributors">1.2. Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">2. Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="useCases.html">3. Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#openstudio-integration">3.1. OpenStudio Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#measures">3.2. Measures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">4. Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#openstudio-integration">4.1. OpenStudio integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#mathematics">4.2. Mathematics</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#fmu-requirements">4.3. FMU Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#qss-implementation">4.4. QSS Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#master-algorithm">4.5. Master Algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="softwareArchitecture.html">5. Software Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#openstudio-integration">5.1. OpenStudio integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#jmodelica-integration">5.2. JModelica Integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="numericalMethods.html">6. Numerical Methods of the Master Algorithm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="numericalMethods.html#time-integration">6.1. Time Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="numericalMethods.html#algebraic-loops">6.2. Algebraic Loops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">7. Application Programming Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#generating-openstudio-models">7.1. Generating OpenStudio Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">8. Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">9. Acknowledgments</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Automated Documentation/AST Support Tool</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#proposed-workflow-process-and-toolchain">Proposed Workflow, Process, and Toolchain</a></li>
<li><a class="reference internal" href="#discussion-and-details">Discussion and Details</a></li>
<li><a class="reference internal" href="#summary-of-questions-and-next-steps">Summary of Questions and Next Steps</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="automated-documentation-ast-support-tool">
<h1>Automated Documentation/AST Support Tool<a class="headerlink" href="#automated-documentation-ast-support-tool" title="Permalink to this headline">¶</a></h1>
<p>This section describes an agreed-upon workflow, toolchain and process to
generate automated SOEP &#8220;documentation&#8221; and abstract syntax trees from Modelica
libraries; in particular, the Modelica Buildings Library (MBL).</p>
<p>The goal of this project is to make the <a class="reference external" href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">abstract syntax tree (AST)</a> of the Modelica
Buildings Library (MBL) <a class="footnote-reference" href="#fn-mbl" id="id1">[1]</a> available to other tools. Specifically, this
work should be of use to the OpenStudio team for discovering available models
and their parameters and other metadata for use from the OpenStudio interface.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Modelica source code contains quite a lot of meta-data in addition to the
mathematical model itself. An annotation system exists within Modelica and
custom annotations can be written to pass data to tools. Annotations were
designed to be an extensible mechanism for capturing meta-data related to a
model including html-documentation, vendor-specific data, and graphical
annotations. Parameters, variables, equations, and models can contain
documentation strings and annotations. Furthermore, packages can be documented
and the display order of sub-packages, models, classes, functions, connectors
and other objects can be specified. Modelica Models also have a hierarchical
structure of packages, models, and models can be composed of multiple (possibly
replaceable) components. Much of this information will be required by the
OpenStudio tool in order to understand which components are available, where
they reside in the library structure, what parameters they have, how they can
be configured, how to display them, and what other meta-data are available
(such as documentation).</p>
<p>From initial discussion with Michael Wetter (LBNL) on this task, we&#8217;ve
identified the main focus will be to make the AST of Modelica source files
including the metadata mentioned above available to the OpenStudio team. We
will specifically focus on the Modelica Buildings Library (MBL), though as we
discuss later, the tool should also be able to work over other Modelica files
and libraries.</p>
<p>The intent of the AST &#8220;documentation&#8221; is <em>primarily</em> to be consumed by the
OpenStudio application for identification of models, model documentation, model
connecting points, inputs/outputs, and parameters and related meta-data.</p>
<p>Presumably, an OpenStudio application will consume some or all of the above
information, use it to provide an interface to the user, and ultimately write
out a Modelica file which connects the various library components, configures
various components and packages (for example, setting the &#8220;media&#8221; or working
fluid of fluid component models in various HVAC loops), and sets the various
parameter values.</p>
<p>To create models, information from other libraries, most notably, the Modelica
Standard Library (MSL) itself, may need to be made available. Typical
applications and examples from the Modelica Buildings Library (MBL) use
component models from both the MSL and MBL. There is also interest in being
able to support additional third party libraries over and above the MSL and
MBL. Therefore, it will be important that this tool is not limited to just
parsing/processing the MBL.</p>
<p>Also, related to meta-data, it has been proposed that the MBL add any
OpenStudio-specific metadata to the MBL files themselves. However, although
this may be easy and feasible for MBL, it may not be practical to consider
annotating the MSL or other third party libraries as we have no direct control
over that library and any custom annotations would have to be re-applied with
future MSL versions. Because of this, to the extent possible, it may be better
to not rely upon custom vendor-specific annotations where possible.</p>
</div>
<div class="section" id="proposed-workflow-process-and-toolchain">
<h2>Proposed Workflow, Process, and Toolchain<a class="headerlink" href="#proposed-workflow-process-and-toolchain" title="Permalink to this headline">¶</a></h2>
<p>We propose to build a stand-alone batch-process program that will transform any
Modelica input file or library (specifically, the Modelica Buildings Library in
particular although we have identified the need to possibly parse the MSL as
well) into an XML document. The XML document will contain:</p>
<ul class="simple">
<li>identification of which models, classes, connectors, functions, etc. exist</li>
<li>identification of the relative hierarchy of the above components within the
package structure of the library</li>
<li><dl class="first docutils">
<dt>for each model, to know</dt>
<dd><ul class="first last">
<li>what connection &#8220;ports&#8221; are available</li>
<li>what control inputs/outputs are available</li>
<li>what parameters are available</li>
<li>what configuration management options exist (ie, replaceable components
and packages)</li>
<li>including meta-data and attributes for all the above such as graphics
annotations, vendor annotations, html documentation, etc.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>We believe the <a class="reference external" href="http://www.jmodelica.org/api-docs/usersguide/JModelicaUsersGuide-1.17.0.pdf">JModelica</a>
tool suite will be able to provide the proper parsing tools for the AST we
need. Specifically, we must ensure that the AST we derive from JModelica meets
all of our needs &#8211; most notably, we must ensure we have access to all
annotations from a model. Thus, there are two key questions we must answer
before deciding whether we can embrace the JModelica toolchain for the current
effort:</p>
<ol class="arabic simple">
<li>Does the JModelica toolchain provide sufficient access to the full AST?</li>
<li>Is that access available through the Python interface?</li>
</ol>
<p>We have confirmed with preliminary work that we can walk a source AST using the
Python API of JModelica 1.17. We have also determined that the AST information
does include annotation data. As such, our recommendation would be to build the
tool in Python.</p>
<p>The Python interface to JModelica appears the most logical choice as it is the
most developed, documented, and user-facing of the APIs for JModelica &#8211; in
fact, it is the only user-facing interface to the open-source JModelica
toolsuite at the moment. We have used and have demonstrated that the JModelica
interface does indeed expose at least some of the main hooks into the compiler
including, most notably, access to the AST including annotations (using version
1.17). Python is well known and loved by many developers, most notably those in
the engineering domain and offers quite a few tools and libraries (including
XML libraries) that can be used/added if needed.</p>
<p>The signature of the batch program we will write will be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ast_doc_gen</span> <span class="o">&lt;</span><span class="n">options</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">out</span> <span class="o">&lt;</span><span class="n">outputfile</span><span class="o">-</span><span class="n">path</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">path_to_modelica_library</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Or looking at this as a data-flow diagram:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">modelica</span><span class="o">-</span><span class="n">library</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">filesystem</span> <span class="o">==&gt;</span> <span class="n">xml</span><span class="o">-</span><span class="n">file</span>
</pre></div>
</div>
<p>The <cite>ast_doc_gen</cite> tool will generate an XML file at <code class="docutils literal"><span class="pre">outputfile-path</span></code> based
on the library available at <code class="docutils literal"><span class="pre">path_to_modelica_library</span></code>. We propose that there
should only be one library documented per XML file. If additional library data
is generated, (for example, the MSL), each library should get its own file.</p>
<p>Options could include flags to allow turning off/on the reporting of various
constructs in the source library.</p>
<p>An additional feature of the tool will be to perform a &#8220;diff&#8221; (i.e., logical
differences) between two generated XML files. The signature for this
application would be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ast_doc_diff</span> <span class="o">&lt;</span><span class="n">options</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">out</span> <span class="o">&lt;</span><span class="n">path_to_diff_report</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">path1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">path2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The data-flow diagram would be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">path2</span><span class="p">)</span> <span class="o">==&gt;</span> <span class="n">xml</span><span class="o">-</span><span class="n">file</span>
</pre></div>
</div>
<p>The purpose of this tool would be to detect any non-trivial differences between
two generated XML files that hold the AST of a Modelica library and report
those changes out to another XML file. The content of this XML file would
explicitly show the differences between the two input manifests. The options
here would allow for tweaking the meaning of what it means to be &#8220;different&#8221;.
For example, depending on the context, the following types of changes may be
ignored:</p>
<ul class="simple">
<li>changes to text in embedded HTML document</li>
<li>changes in ordering of classes/models in a package</li>
<li>addition of new functions (assuming functions would not be directly consumed
by the OpenStudio tool)</li>
</ul>
</div>
<div class="section" id="discussion-and-details">
<h2>Discussion and Details<a class="headerlink" href="#discussion-and-details" title="Permalink to this headline">¶</a></h2>
<p>A key area of agreement will need to be reached on what data gets put into the
XML output. Specifically, we need to think through how to represent the
models in the MBL in such a way that they can be consumed by the <em>OpenStudio</em>
toolchain. At the planning meeting on February 1, 2017, it was discussed that
we generally want all of the information from the source AST <em>except</em> equation
and algorithm sections. All annotations should be made available.</p>
<p>One consideration will be: which version of the AST should be used to represent
packages, classes, models, etc. The <a class="reference external" href="http://www.jmodelica.org/api-docs/usersguide/JModelicaUsersGuide-1.17.0.pdf">JModelica User&#8217;s Guide 1.17</a>
in Chapter 9 talks about three kinds of AST: source level, instance level, and
flattened.  The flattened AST is not relevant for us (it corresponds to a fully
flattened model instance ready to be compiled; our interest is in browsing all
objects for potential configuration).</p>
<p>The source level AST corresponds 1:1 to the original files in both structure
and content. Although the source AST is what we need, it does not expand out
components and extended classes and thus may require additional processing by
consumers.</p>
<p>An instance level AST, in contrast, represents the fully expanded instance of a
given model or class, including configurations. Although this is tempting to
use, we are dealing with a library, not a model <em>instance</em>. It will be
<em>OpenStudio</em>&#8216;s job to build and specify a model class to instantiate.
Especially due to Modelica&#8217;s configuration mechanism, it would be dangerous to
treat object <em>classes</em> as <em>instances</em>.</p>
<p>For an example, consider the following model (adapted from <a class="reference external" href="http://book.xogeny.com/components/components/elec_comps/">Modelica by
Example: Electrical Components</a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">Ex1</span>
  <span class="n">connector</span> <span class="n">PositivePin</span> <span class="s2">&quot;Positive pin of an electric component&quot;</span>
    <span class="n">Modelica</span><span class="o">.</span><span class="n">SIunits</span><span class="o">.</span><span class="n">Voltage</span> <span class="n">v</span> <span class="s2">&quot;Potential at the pin&quot;</span><span class="p">;</span>
    <span class="n">flow</span> <span class="n">Modelica</span><span class="o">.</span><span class="n">SIunits</span><span class="o">.</span><span class="n">Current</span> <span class="n">i</span> <span class="s2">&quot;Current flowing into the pin&quot;</span><span class="p">;</span>
  <span class="n">end</span> <span class="n">PositivePin</span><span class="p">;</span>

  <span class="n">connector</span> <span class="n">NegativePin</span> <span class="s2">&quot;Negative pin of an electric component&quot;</span>
    <span class="n">Modelica</span><span class="o">.</span><span class="n">SIunits</span><span class="o">.</span><span class="n">Voltage</span> <span class="n">v</span> <span class="s2">&quot;Potential at the pin&quot;</span><span class="p">;</span>
    <span class="n">flow</span> <span class="n">Modelica</span><span class="o">.</span><span class="n">SIunits</span><span class="o">.</span><span class="n">Current</span> <span class="n">i</span> <span class="s2">&quot;Current flowing into the pin&quot;</span><span class="p">;</span>
  <span class="n">end</span> <span class="n">NegativePin</span><span class="p">;</span>

  <span class="n">partial</span> <span class="n">model</span> <span class="n">TwoPin</span> <span class="s2">&quot;Common elements of two pin electrical components&quot;</span>
    <span class="n">parameter</span> <span class="n">Bool</span> <span class="n">useTheMod</span><span class="o">=</span><span class="n">false</span> <span class="s2">&quot;If true, use thermal model&quot;</span><span class="p">;</span>
    <span class="n">PositivePin</span> <span class="n">p</span>
      <span class="n">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">},{</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">10</span><span class="p">}})));</span>
    <span class="n">NegativePin</span> <span class="n">n</span>
      <span class="n">annotation</span> <span class="p">(</span><span class="n">Placement</span><span class="p">(</span><span class="n">transformation</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="p">{{</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">},{</span><span class="mi">110</span><span class="p">,</span><span class="mi">10</span><span class="p">}})));</span>
  <span class="n">protected</span>
    <span class="n">Modelica</span><span class="o">.</span><span class="n">SIunits</span><span class="o">.</span><span class="n">Voltage</span> <span class="n">v</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">v</span><span class="o">-</span><span class="n">n</span><span class="o">.</span><span class="n">v</span><span class="p">;</span>
    <span class="n">Modelica</span><span class="o">.</span><span class="n">SIunits</span><span class="o">.</span><span class="n">Current</span> <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">i</span><span class="p">;</span>
  <span class="n">equation</span>
    <span class="n">p</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="s2">&quot;Conservation of charge&quot;</span><span class="p">;</span>
  <span class="n">end</span> <span class="n">TwoPin</span><span class="p">;</span>

  <span class="n">model</span> <span class="n">Resistor</span> <span class="s2">&quot;A DRY resistor model&quot;</span>
    <span class="n">extends</span> <span class="n">TwoPin</span><span class="p">;</span>
    <span class="n">parameter</span> <span class="n">Modelica</span><span class="o">.</span><span class="n">SIunits</span><span class="o">.</span><span class="n">Resistance</span> <span class="n">R</span><span class="p">;</span>
  <span class="n">equation</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">R</span> <span class="s2">&quot;Ohm&#39;s law&quot;</span><span class="p">;</span>
  <span class="n">end</span> <span class="n">Resistor</span><span class="p">;</span>
<span class="n">end</span> <span class="n">Example1</span><span class="p">;</span>
</pre></div>
</div>
<p>In this (very simple) model described above, a possible XML representation might be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--
  A library could be given a different ID than the top level package
  name. For example, the &quot;Modelica Buildings Library&quot;&#39;s top level package
  is &quot;Buildings&quot;. Here, we use Example1 for the library name and
  &quot;Ex1&quot; for the top-level package name. Presumably, the &quot;Example1&quot; meta
  data has been passed in out-of-band or via the annotation mechanism.
--&gt;
&lt;lib id=&quot;Example1&quot;&gt;
  &lt;package id=&quot;Ex1&quot;&gt;
    &lt;!-- specify package order by top-level model ids --&gt;
    &lt;order&gt;Ex1.PositivePin,Ex1.NegativePin,Ex1.TwoPin,Ex1.Resistor&lt;/order&gt;
    &lt;connectors&gt;
      &lt;!--
        below, we derive a unique &quot;hash-key&quot; for the type that will allow
        us to identify that PositivePin connectors can be connected to
        NegativePin connectors

        Note: we use the fully qualified names for IDs both because XML
        requires unique ids and also for our identification purposes.

        The &quot;f:&quot; and &quot;p:&quot; prefixes indicate f: as &quot;flow&quot; and p as
        &quot;potential&quot; variables. An &quot;s:&quot; prefix would indicate a &quot;stream&quot;
        variable. The hash is the listing of all types in a connection with
        prefixes put together in alphabetical order separated by
        semicolons. Comparing on these type hashes would allow a tool to
        know which connectors could be connected together.
      --&gt;
      &lt;connector
        id=&quot;Ex1.PositivePin&quot;
        type=&quot;f:Modelica.SIunits.Current;p:Modelica.SIunits.Voltage&quot;&gt;
        &lt;variable
          id=&quot;Ex1.PositivePin.v&quot;
          type=&quot;Modelica.SIunits.Voltage&quot;
          connect_type=&quot;potential&quot;
          doc=&quot;Potential at the pin&quot;/&gt;
        &lt;var
          id=&quot;Ex1.PositivePin.i&quot;
          type=&quot;Modelica.SIunits.Current&quot;
          connect_type=&quot;flow&quot;
          doc=&quot;Potential at the pin&quot;/&gt;
      &lt;/connector&gt;
      &lt;connector
        id=&quot;Ex1.NegativePin&quot;
        type=&quot;f:Modelica.SIunits.Current;p:Modelica.SIunits.Voltage&quot;&gt;
        &lt;variable
          id=&quot;Ex1.NegativePin.v&quot;
          type=&quot;Modelica.SIunits.Voltage&quot;
          connect_type=&quot;potential&quot;
          doc=&quot;Potential at the pin&quot;/&gt;
        &lt;variable
          id=&quot;Ex1.NegativePin.i&quot;
          type=&quot;Modelica.SIunits.Current&quot;
          connect_type=&quot;flow&quot;
          doc=&quot;Potential at the pin&quot;/&gt;
      &lt;/connector&gt;
    &lt;/connectors&gt;
    &lt;models&gt;
      &lt;model
        id=&quot;Ex1.TwoPin&quot;
        type=&quot;partial&quot;
        doc=&quot;Common elements of two pin electrical components&quot;&gt;
        &lt;var
          type=&quot;Bool&quot;
          id=&quot;Ex1.TwoPin.useTheMod&quot;
          variability=&quot;parameter&quot;&gt;
          false
        &lt;/var&gt;
        &lt;var
          type=&quot;Ex1.PositivePin&quot;
          id=&quot;Ex1.TwoPin.p&quot;
          variability=&quot;continuous&quot;&gt;
          &lt;!--
            Note: &quot;Placement&quot; annotation downcased
          --&gt;
          &lt;annotation&gt;
            &lt;placement&gt;
              &lt;transformation&gt;
                &lt;extent&gt;{{-110,-10},{-90,10}}&lt;/extent&gt;
              &lt;/transformation&gt;
            &lt;/placement&gt;
          &lt;/annotation&gt;
        &lt;/var&gt;
        &lt;var
          type=&quot;Ex1.NegativePin&quot;
          id=&quot;Ex1.TwoPin.n&quot;
          variability=&quot;continuous&quot;&gt;
          &lt;annotation&gt;
            &lt;placement&gt;
              &lt;transformation&gt;
                &lt;extent&gt;{{90,-10},{110,10}}&lt;/extent&gt;
              &lt;/transformation&gt;
            &lt;/placement&gt;
          &lt;/annotation&gt;
        &lt;/var&gt;
        &lt;var
          type=&quot;Modelica.SIunits.Voltage&quot;
          id=&quot;Ex1.TwoPin.v&quot;
          variability=&quot;continuous&quot;
          visibility=&quot;protected&quot;&gt;
          &lt;annotation&gt;
            &lt;placement&gt;
              &lt;transformation&gt;
                &lt;extent&gt;{{90,-10},{110,10}}&lt;/extent&gt;
              &lt;/transformation&gt;
            &lt;/placement&gt;
          &lt;/annotation&gt;
        &lt;/var&gt;
        &lt;var
          type=&quot;Modelica.SIunits.Current&quot;
          id=&quot;Ex1.TwoPin.i&quot;
          variability=&quot;continuous&quot;
          visibility=&quot;protected&quot;&gt;
          &lt;annotation&gt;
            &lt;placement&gt;
              &lt;transformation&gt;
                &lt;extent&gt;{{90,-10},{110,10}}&lt;/extent&gt;
              &lt;/transformation&gt;
            &lt;/placement&gt;
          &lt;/annotation&gt;
        &lt;/var&gt;
        &lt;!-- equation section elided... --&gt;
      &lt;/model&gt;
      &lt;!-- OK, and finally the Resistor --&gt;
      &lt;model
        id=&quot;Ex1.Resistor&quot;
        doc=&quot;A DRY resistor model&quot;&gt;
        &lt;extends&gt;Ex1.TwoPin&lt;/extends&gt;
        &lt;var
          type=&quot;Modelica.SIunits.Resistance&quot;
          id=&quot;Ex1.Resistor.R&quot;
          variability=&quot;parameter&quot;&gt;
        &lt;/var&gt;
        &lt;!-- equation section elided... --&gt;
      &lt;/model&gt;
    &lt;/models&gt;
  &lt;/package&gt;
&lt;/lib&gt;
</pre></div>
</div>
<p>Fortunately, there have been several attempts to represent or use XML in relation
to Modelica in the past:</p>
<ul class="simple">
<li><a class="reference external" href="https://gupea.ub.gu.se/bitstream/2077/38718/1/gupea_2077_38718_1.pdf">N. Landin. (2014). &#8220;XML export and import of Modelica Models&#8221;</a></li>
<li><a class="reference external" href="https://github.com/modelica-association/ModelicaXML">ModelicaXML Schema</a></li>
<li><a class="reference external" href="http://onlinelibrary.wiley.com/store/10.1002/9780470545669.app7/asset/app7.pdf?v=1&amp;t=iyq3ixri&amp;s=3acd1aef6559f8c230d827878d73980bdd1407f2">Appendix G of Fritzson (2004) &#8220;Principles of ... with Modelica 2.1&#8221;</a></li>
<li><a class="reference external" href="https://modelica.org/events/Conference2003/papers/h39_Pop.pdf">A. Pop and P. Fritzson. (2003). &#8220;ModelicaXML...&#8221;</a></li>
<li><a class="reference external" href="http://www.ida.liu.se/~adrpo33/modelica/ModelicaXML-Presentation-2003-11-04.pdf">A. Pop and P. Fritzson. ModelicaXML Presentation</a></li>
<li><a class="reference external" href="https://www.modelica.org/events/modelica2006/Proceedings/sessions/Session6d1.pdf">U. Reisenbichler et al. 2006. &#8220;If we only had used XML...&#8221;</a></li>
</ul>
<p>In particular, the first reference above links to a 2014 Master&#8217;s Thesis
describing the work of N. Landin with Modelon using JModelica to export XML for
the purpose of model exchange &#8211; this is very similar to our use case.
Unfortunately, this work deals only with &#8220;flattened&#8221; models &#8211; Modelica models
that have been instantiated with all of the hierarchy removed. For our use
case, the hierarchy must be preserved so that the OpenStudio team can
<em>construct</em> a new model from existing library definitions.</p>
<p>The paper by Reisenbichler 2006 motivates the usage of XML in association with
Modelica without getting into specifics. The remaining work by Pop and Fritzson
is thus the only comprehensive proposals for an XML representation of Modelica
<em>source</em> AST. The purpose of the XML work by Pop and Fritzson was to create a
complete XML representation of the entire Modelica source. It is generally a good
reference but we note that it is, perhaps unnecessarily, verbose for our
current needs. As such, we plan to study this work but will not tie ourselves
to it.</p>
</div>
<div class="section" id="summary-of-questions-and-next-steps">
<h2>Summary of Questions and Next Steps<a class="headerlink" href="#summary-of-questions-and-next-steps" title="Permalink to this headline">¶</a></h2>
<p><strong>Questions</strong>:</p>
<ul class="simple">
<li>It is our understanding that there is both a paid &#8220;proprietary&#8221; API as well
as an &#8220;open source&#8221; API (which is not guaranteed to be stable) for accessing
the AST of JModelica. Can we get a better understanding of the differences
between the two?</li>
<li>We have confirmed that JModelica 1.17 does support parsing AST of annotations
and models. We need to confirm that custom directives are supported as well.</li>
<li>The exact data design for XML output must to be determined. What data will
the OpenStudio need access to?</li>
</ul>
<p><strong>Next Steps</strong>:</p>
<ul class="simple">
<li>Write a tool using the JModelica Python API to extract AST data from Modelica
Models in a library and write that data out as XML</li>
<li>Design the XML end format</li>
<li>Create diff tool for comparing xml library dumps in a meaningful way</li>
</ul>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>JModelica User Guide</p>
<blockquote>
<div>&#8220;JModelica.org User Guide: Version 1.17&#8221;. Available at:
<a class="reference external" href="http://www.jmodelica.org/api-docs/usersguide/JModelicaUsersGuide-1.17.0.pdf">http://www.jmodelica.org/api-docs/usersguide/JModelicaUsersGuide-1.17.0.pdf</a></div></blockquote>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fn-mbl" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Our main focus is to support the Modelica Buildings Library but
the tool should also work for other Modelica file import/parsing
tasks</td></tr>
</tbody>
</table>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright (c) All rights reserved.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.<br/>
    </p>
  </div>
</footer>

  </body>
</html>